define("block_coursefeedback/notif",["exports","core/ajax","core/str"],(function(_exports,_ajax,Str){var obj;
/**
   * Manager for the coursefeedback blocks rankingpage (ranking.php).
   *
   * @module      block_coursefeedback
   * @copyright  2023 innoCampus, Technische UniversitÃ¤t Berlin
   * @author     2011-2023 onwards Jan Eberhardt
   * @author     2022 onwards Felix Di Lenarda
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initialise=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj},Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);let courseId,feedbackId,questionId,questionType,questionSum,textarea,essayContainer,schoolgradesContainer,sendingActive=!1;function fadeOut(element){return new Promise((resolve=>{let opacity=parseFloat(window.getComputedStyle(element).getPropertyValue("opacity"));isNaN(opacity)&&(opacity=0);let fadingOut=setInterval((function(){opacity<=0?(clearInterval(fadingOut),resolve()):(opacity-=.1,element.style.opacity=opacity)}),50)}))}function fadeIn(element){let opacity=parseFloat(window.getComputedStyle(element).getPropertyValue("opacity"));isNaN(opacity)&&(opacity=0);let fadingIn=setInterval((function(){opacity>=1?clearInterval(fadingIn):(opacity+=.1,element.style.opacity=opacity)}),50)}const sendAndReceiveFeedback=(feedback,essay)=>{if(1==sendingActive)return;sendingActive=!0;let notifikations=document.getElementById("user-notifications"),feedbackNotif=notifikations.getElementsByClassName("cfb-notification-container")[0],questionInfo=notifikations.getElementsByClassName("cfb-question-info")[0],question=notifikations.getElementsByClassName("cfb-question")[0],notif=feedbackNotif.parentElement,foPromise=fadeOut(notif);_ajax.default.call([{methodname:"block_coursefeedback_answer_question_and_get_new",args:{courseid:courseId,feedback:feedback,essay:essay,feedbackid:feedbackId,questionid:questionId}}])[0].done((function(data){foPromise.then((()=>{if(null===data.nextquestion){Str.get_string("notif_thankyou","block_coursefeedback").done((function(string){feedbackNotif.innerHTML=string,fadeIn(notif)}))}else{questionId=data.nextquestionid,textarea.value="";let nextQuestionType=data.nextquestiontype;questionType!==nextQuestionType&&(1===nextQuestionType?(schoolgradesContainer.classList.remove("d-none"),essayContainer.classList.add("d-none")):2===nextQuestionType&&(schoolgradesContainer.classList.add("d-none"),essayContainer.classList.remove("d-none")),questionType=nextQuestionType),Str.get_string("notif_question","block_coursefeedback").done((function(string){questionInfo.innerHTML=string.concat(questionId).concat("/").concat(questionSum).concat(": "),question.innerHTML=data.nextquestion,sendingActive=!1,fadeIn(notif)}))}}))})).fail((function(ex){window.console.error(ex)}))};_exports.initialise=(cid,fbid,quid,qutype,qusum)=>{courseId=cid,feedbackId=fbid,questionId=quid,questionType=qutype,questionSum=qusum;let notifikations=document.getElementById("user-notifications");notifikations.getElementsByClassName("cfb-notification-container")[0].parentElement.removeAttribute("role");const emojis=[...notifikations.getElementsByClassName("cfb-fbemoji")];emojis.map((emoji=>{let answer=emojis.indexOf(emoji)+1;emoji.onclick=()=>{sendAndReceiveFeedback(answer,null)}}));let div=document.getElementsByClassName("cfb-essaytextarea")[0];textarea=document.createElement("textarea"),textarea.classList.add("w-100","rounded"),textarea.id="cfb-essay-textarea",div.appendChild(textarea),document.getElementsByClassName("cfb-essaysendbtn")[0].onclick=()=>{let essayanswer=textarea.value;sendAndReceiveFeedback(null,essayanswer)};let buttonContainer,overlayIcon=notifikations.getElementsByClassName("cfb-overlay-icon")[0];schoolgradesContainer=notifikations.getElementsByClassName("cfb-schoolgrades-containaer")[0],essayContainer=notifikations.getElementsByClassName("cfb-essay-containaer")[0],1==questionType?(buttonContainer=schoolgradesContainer,buttonContainer.style.opacity=0,buttonContainer.classList.remove("d-none")):2==questionType&&(buttonContainer=essayContainer,buttonContainer.style.opacity=0,buttonContainer.classList.remove("d-none"));let element=document.querySelector(".cfb-overlay-icon");element&&element.remove(),fadeOut(overlayIcon).then((()=>{fadeIn(buttonContainer)}))}}));

//# sourceMappingURL=notif.min.js.map